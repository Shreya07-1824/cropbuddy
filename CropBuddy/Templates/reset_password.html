<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
</head>
<body>
  <div class="container">
    <h2>{{t("Reset Your Password")}}</h2>
    <form action="/reset-password/{{ token }}" method="POST" onsubmit="return validatePasswords(event)">
      <label for="new_password">{{t("New Password")}}</label>
      <input type="password" id="new_password" name="new_password" 
             pattern="(?=.*[0-9])(?=.*[a-zA-Z]).{6,}" 
             title="{{t('Must contain at least 6 characters with letters and numbers')}}"
             placeholder="{{t('Enter new password')}}" required>

      <label for="confirm_password">{{t("Confirm Password")}}</label>
      <input type="password" id="confirm_password" name="confirm_password" 
             placeholder="Confirm new password" required>

      <button type="submit">{{t("Reset Password")}}</button>
    </form>
  </div>

  <!-- Modal -->
  {% if alert_message %}
  <div id="customModal" class="modal" style="display: flex;">
    <div class="modal-content">
      <p>{{ alert_message }}</p>
      <button onclick="closeModal()">OK</button>
    </div>
  </div>
  {% endif %}

  <script>
    function validatePasswords(event) {
      let newPass = document.getElementById("new_password").value;
      let confirmPass = document.getElementById("confirm_password").value;

      if (newPass !== confirmPass) {
        event.preventDefault();
        showModal("{{t('Passwords do not match. Please try again')}}");
        return false;
      }
      return true;
    }

    function showModal(message) {
      const modal = document.getElementById('customModal');
      if (!modal) {
        // Create modal if it doesn't exist
        const modalDiv = document.createElement('div');
        modalDiv.id = 'customModal';
        modalDiv.className = 'modal';
        modalDiv.style.display = 'flex';
        modalDiv.innerHTML = `
          <div class="modal-content">
            <p>${message}</p>
            <button onclick="closeModal()">{{t("OK")}}</button>
          </div>
        `;
        document.body.appendChild(modalDiv);
      } else {
        const messageEl = modal.querySelector('p');
        messageEl.textContent = message;
        modal.style.display = 'flex';
      }
    }

    function closeModal() {
      const modal = document.getElementById('customModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('customModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }
  </script>
</body>
</html>